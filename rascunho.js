
// feriados em JSON https://gist.githubusercontent.com/sistematico/0d795e73e133632204593f1d1db4a618/raw/c9e3db43cd1e1743e36f22cea1eb25a4bb8fc5e1/feriados.json
var feriados = {
  "2021-01-01": "Confraternização Universal",
  "2021-02-16": "Carnaval",
  "2021-04-02": "Paixão de Cristo",
  "2021-04-21": "Tiradentes",
  "2021-05-01": "Dia do Trabalho",
  "2021-06-03": "Corpus Christi",
  "2021-08-08": "Dia dos Pais",
  "2021-09-07": "Independência do Brasil",
  "2021-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2021-11-02": "Finados",
  "2021-11-15": "Proclamação da República",
  "2021-12-25": "Natal",
  "2022-01-01": "Confraternização Universal",
  "2022-03-01": "Carnaval",
  "2022-04-15": "Paixão de Cristo",
  "2022-04-21": "Tiradentes",
  "2022-05-01": "Dia do Trabalho",
  "2022-06-16": "Corpus Christi",
  "2022-08-14": "Dia dos Pais",
  "2022-09-07": "Independência do Brasil",
  "2022-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2022-11-02": "Finados",
  "2022-11-15": "Proclamação da República",
  "2022-12-25": "Natal",
  "2023-01-01": "Confraternização Universal",
  "2023-02-21": "Carnaval",
  "2023-04-07": "Paixão de Cristo",
  "2023-04-21": "Tiradentes",
  "2023-05-01": "Dia do Trabalho",
  "2023-06-08": "Corpus Christi",
  "2023-08-13": "Dia dos Pais",
  "2023-09-07": "Independência do Brasil",
  "2023-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2023-11-02": "Finados",
  "2023-11-15": "Proclamação da República",
  "2023-12-25": "Natal",
  "2024-01-01": "Confraternização Universal",
  "2024-02-13": "Carnaval",
  "2024-03-29": "Paixão de Cristo",
  "2024-04-21": "Tiradentes",
  "2024-05-01": "Dia do Trabalho",
  "2024-05-30": "Corpus Christi",
  "2024-08-11": "Dia dos Pais",
  "2024-09-07": "Independência do Brasil",
  "2024-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2024-11-02": "Finados",
  "2024-11-15": "Proclamação da República",
  "2024-12-25": "Natal",
  "2025-01-01": "Confraternização Universal",
  "2025-03-04": "Carnaval",
  "2025-04-18": "Paixão de Cristo",
  "2025-04-21": "Tiradentes",
  "2025-05-01": "Dia do Trabalho",
  "2025-06-19": "Corpus Christi",
  "2025-08-10": "Dia dos Pais",
  "2025-09-07": "Independência do Brasil",
  "2025-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2025-11-02": "Finados",
  "2025-11-15": "Proclamação da República",
  "2025-12-25": "Natal",
  "2026-01-01": "Confraternização Universal",
  "2026-02-17": "Carnaval",
  "2026-04-03": "Paixão de Cristo",
  "2026-04-21": "Tiradentes",
  "2026-05-01": "Dia do Trabalho",
  "2026-06-04": "Corpus Christi",
  "2026-08-09": "Dia dos Pais",
  "2026-09-07": "Independência do Brasil",
  "2026-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2026-11-02": "Finados",
  "2026-11-15": "Proclamação da República",
  "2026-12-25": "Natal",
  "2027-01-01": "Confraternização Universal",
  "2027-02-09": "Carnaval",
  "2027-03-26": "Paixão de Cristo",
  "2027-04-21": "Tiradentes",
  "2027-05-01": "Dia do Trabalho",
  "2027-05-27": "Corpus Christi",
  "2027-08-08": "Dia dos Pais",
  "2027-09-07": "Independência do Brasil",
  "2027-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2027-11-02": "Finados",
  "2027-11-15": "Proclamação da República",
  "2027-12-25": "Natal",
  "2028-01-01": "Confraternização Universal",
  "2028-02-29": "Carnaval",
  "2028-04-14": "Paixão de Cristo",
  "2028-04-21": "Tiradentes",
  "2028-05-01": "Dia do Trabalho",
  "2028-06-15": "Corpus Christi",
  "2028-09-07": "Independência do Brasil",
  "2028-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2028-11-02": "Finados",
  "2028-11-15": "Proclamação da República",
  "2028-12-25": "Natal",
  "2029-01-01": "Confraternização Universal",
  "2029-02-13": "Carnaval",
  "2029-03-30": "Paixão de Cristo",
  "2029-04-21": "Tiradentes",
  "2029-05-01": "Dia do Trabalho",
  "2029-05-31": "Corpus Christi",
  "2029-09-07": "Independência do Brasil",
  "2029-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2029-11-02": "Finados",
  "2029-11-15": "Proclamação da República",
  "2029-12-25": "Natal",
  "2030-01-01": "Confraternização Universal",
  "2030-03-05": "Carnaval",
  "2030-04-19": "Paixão de Cristo",
  "2030-04-21": "Tiradentes",
  "2030-05-01": "Dia do Trabalho",
  "2030-06-20": "Corpus Christi",
  "2030-09-07": "Independência do Brasil",
  "2030-10-12": "Nossa Sr.a Aparecida - Padroeira do Brasil",
  "2030-11-02": "Finados",
  "2030-11-15": "Proclamação da República",
  "2030-12-25": "Natal"
}

var dados = [{"data_inicial":"2022-06-01T09:30:00","data_final":"2022-06-01T10:00:00","recorrencia":"1","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"Projeto SGE - Sistema de Gestão do Espectro","numerosei":null},{"data_inicial":"2022-06-01T10:00:00","data_final":"2022-06-01T10:30:00","recorrencia":"1","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"RGL - Regulamento Geral de Licenciamento de Estações","numerosei":null},{"data_inicial":"2022-06-01T10:30:00","data_final":"2022-06-01T11:00:00","recorrencia":"1","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"Projeto Mosaico","numerosei":null},{"data_inicial":"2022-06-01T11:00:00","data_final":"2022-06-01T12:00:00","recorrencia":"1","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"997_S_60_Média","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"60","descricao":"Projeto Certifica - Certificação de Equipamentos","numerosei":null},{"data_inicial":"2022-06-01T14:30:00","data_final":"2022-06-01T15:00:00","recorrencia":"1","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"RCR - Regulamento Sobre Canalização e Condições de Uso de Radiofrequências","numerosei":null},{"data_inicial":"2022-06-01T15:15:00","data_final":"2022-06-01T15:45:00","recorrencia":"1","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"Sustentação - andamento dos chamados Visão e demandas de sustentação dos demais sistemas da SOR.","numerosei":null},{"data_inicial":"2022-06-03T14:00:00","data_final":"2022-06-03T14:30:00","recorrencia":"7","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"RCR Review","numerosei":null},{"data_inicial":"2022-06-01T14:30:00","data_final":"2022-06-01T15:00:00","recorrencia":"7","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"Reunião dos Coordenadores e Substitutos","numerosei":null},{"data_inicial":"2022-06-03T15:30:00","data_final":"2022-06-03T16:30:00","recorrencia":"7","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"997_S_60_Média","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"60","descricao":"Reunião Gerencial","numerosei":null},{"data_inicial":"2022-06-10T15:00:00","data_final":"2022-06-10T16:00:00","recorrencia":"15","recorrencia_final":"2022-12-31T00:00:00","cod_atividade":"997_S_60_Média","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"60","descricao":"Review de final de Sprint com toda a equipe GIDS3","numerosei":null},{"data_inicial":"2022-06-01T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1005_S_240_Muito Alta","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"240","descricao":"Organização pessoal e tratativas com AFPE para iniciar na GIDS3.","numerosei":null},{"data_inicial":"2022-06-01T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1017_S_30_Baixa","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"30","descricao":"Acompanhamento de mensagens das equipes no Teams.","numerosei":null},{"data_inicial":"2022-06-02T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1005_S_240_Muito Alta","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"240","descricao":"Organização pessoal após a mudança de lotação. Procurei ter uma visão geral do conteúdo do SEI e grupos do Teams na GIDS.","numerosei":null},{"data_inicial":"2022-06-02T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1017_S_30_Baixa","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"30","descricao":"Acompanhamento de mensagens das equipes no Teams.","numerosei":null},{"data_inicial":"2022-06-03T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"Apresentação do RGE para o Superintendente, Gerente GIDS e GIDS3. O desenvolvedor (Anderson) demonstrou a apresentação de estações no mapa do RGE, entre outras para o estudo de compatibilidade de radiofrequência pela outorga.","numerosei":null},{"data_inicial":"2022-06-03T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"Prorrogação da reunião RCR Review.","numerosei":null},{"data_inicial":"2022-06-03T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"996_S_30_Baixa","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"30","descricao":"Reunião com o Rodney sobre o sistema Marval (Visão) e sua relação com faturamento e SLA do contrato de postos de trabalho.","numerosei":null},{"data_inicial":"2022-06-03T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"997_S_60_Média","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"60","descricao":"Reunião com o Rodney em que ele apresentou a estruturação da SGI e responsabilidades das coordenações das GIDS.","numerosei":null},{"data_inicial":"2022-06-03T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1017_S_30_Baixa","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"30","descricao":"Acompanhamento de mensagens das equipes no Teams.","numerosei":null},{"data_inicial":"2022-06-06T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1018_S_60_Média","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"60","descricao":"Acompanhamento de mensagens das equipes no Teams.","numerosei":null},{"data_inicial":"2022-06-06T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1001_S_30_Muito Baixa","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"30","descricao":"Criação do Plano de Trabalho SEI nº 8581172.","numerosei":null},{"data_inicial":"2022-06-06T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1002_S_60_Baixa","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"60","descricao":"Assisti apresentação do Nei Jobson sobre o PGD.","numerosei":null},{"data_inicial":"2022-06-06T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1001_S_30_Muito Baixa","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"30","descricao":"Assisti apresentação do Nei Jobson sobre o PGD.","numerosei":null},{"data_inicial":"2022-06-06T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1002_S_60_Baixa","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"60","descricao":"Assisti apresentação sobre a ORLE para compreensão do Mosaico.","numerosei":null},{"data_inicial":"2022-06-06T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1001_S_30_Muito Baixa","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"30","descricao":"Estudei apresentação (power point) da ORLE sobre Outorga e Licenciamento.","numerosei":null},{"data_inicial":"2022-06-07T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"997_S_60_Média","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"60","descricao":"Vanessa me repassou conhecimento sobre o PGD na SGI.","numerosei":null},{"data_inicial":"2022-06-07T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1017_S_30_Baixa","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"30","descricao":"Acompanhamento de mensagens das equipes no Teams.","numerosei":null},{"data_inicial":"2022-06-07T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1003_S_120_Média","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"120","descricao":"Criação do meu Processo PGD. Estudei a tabela de atividades do PGD/SGI e explorei funcionalidades do sistema SEI/PGD.","numerosei":null},{"data_inicial":"2022-06-07T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1002_S_60_Baixa","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"60","descricao":"Estudo do Processo 53500.031601/2022-11, em que participo como fiscal substituto da contratação de postos de trabalho.","numerosei":null},{"data_inicial":"2022-06-08T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1018_S_60_Média","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"60","descricao":"Acompanhamento de mensagens das equipes no Teams.","numerosei":null},{"data_inicial":"2022-06-08T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1003_S_120_Média","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"120","descricao":"Estudo do Processo 53500.031601/2022-11","numerosei":null},{"data_inicial":"2022-06-08T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"997_S_60_Média","atividade":"Atividades Comuns - Participar de reuniões e similares","duracao":"60","descricao":"Reunião com Rodney sobre o projeto Certifica","numerosei":null},{"data_inicial":"2022-06-08T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1001_S_30_Muito Baixa","atividade":"Atividades Comuns - Pesquisar ou estudar assunto","duracao":"30","descricao":"Visão geral de projetos e tarefas existentes no SGDTI","numerosei":null},{"data_inicial":"2022-06-09T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1019_S_120_Alta","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"120","descricao":"Preenchimento do PGD desde a nomeção na GIDS3.","numerosei":null},{"data_inicial":"2022-06-09T00:00:00","data_final":null,"recorrencia":null,"recorrencia_final":null,"cod_atividade":"1018_S_60_Média","atividade":"Atividades Comuns - Tratar demandas gerais","duracao":"60","descricao":"Preenchimento do PGD desde a nomeção na GIDS3.","numerosei":null}]

var UM_DIA = 60000*60*24

/**
 * @param {Date} data
*/
function isDiaUtil(data){
	var b = (data.getDay() != 0 && data.getDay() != 6) //final de semana
	var ano = data.getFullYear()
	var mes = data.getMonth()+1
	var dia = data.getDate()
	mes = (mes < 10)? `0${mes}` : mes

	return b || !feriados.hasOwnProperty(`${ano}-${mes}-${dia}`)
}

/**
 * @param {Date} desde início do evento recorrente
 * @param {Date} ate final do evento recorrente
 * @param {Date} ini corte de início
 * @param {Date} fim corte de fim
 * @param {Integer} freq em dias
*/
function datasRecorrentes(desde,ate,freq,ini,fim){
	var dias = []
	for(data=desde.getTime(); data<=ate.getTime(); data+=freq*UM_DIA){
		if (data >= ini.getTime() && data <= fim.getTime()){
		// console.log(new Date(data))
		// console.log(new Date(desde))
		// console.log("================")
			var data_obj = new Date(data)
			if (isDiaUtil(data_obj))
				dias.push(data_obj)
		}
	}
	// console.log("###########################")
	return dias;
}

/**
 * @param {Object} obj objeto de compromisso/tarefa
 * @param {Date} data_inicial
 * @param {Date} data_final
*/
function compromissosRecorrentes(obj, data_inicial, data_final){
	var recorrentes = []
	if(obj["recorrencia"] != null){
		var compromisso_final = new Date(obj["recorrencia_final"])
		if (data_final.getTime() <= compromisso_final.getTime()){
			var dias = datasRecorrentes(new Date(obj["data_inicial"]),
				compromisso_final,
				parseInt(obj["recorrencia"]),
				data_inicial,
				data_final
				);

			if(dias.length==0)
				return []
			
			// console.log(`DIAS ${dias.length} ${dias[0]} ${dias[dias.length-1]}`)

			for(k=0; k<dias.length; k++){
				var compromisso = JSON.parse(JSON.stringify(obj));
				compromisso["recorrencia"] = null
				compromisso["data_inicial"] = dias[k].toISOString()
				compromisso["data_final"] = null
				recorrentes.push(compromisso)
			}
		}
	}
	return recorrentes
}


// testando
var eventos = []
var inicio = new Date("2022-06-01T00:00:00")
var final = new Date("2022-06-08T23:59:59")

for(i=0; i<dados.length; i++){
	if(dados[i]["recorrencia"] == null){
		eventos.push(dados[i])
	} else {
		var recorrentes = compromissosRecorrentes(dados[i], inicio, final)
		for(k=0; k<recorrentes.length; k++)
			eventos.push(recorrentes[k])
	}
}

var soma = 0
for(i=0;i<eventos.length;i++)
	soma+=parseInt(eventos[i].duracao)
console.log(`SOMA=${soma}min ou ${soma/60}h`)